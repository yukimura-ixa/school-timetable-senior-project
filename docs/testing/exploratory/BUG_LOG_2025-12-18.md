# Bug Log – 2025-12-18

## P1 / Major – Dashboard throws React error #418 after successful login
- **Severity:** P1 (stability)  
- **Impact:** Runtime console error on authenticated dashboard; may indicate hydration/markup mismatch and hides other errors; could break future components.  
- **Environment:** https://phrasongsa-timetable.vercel.app/dashboard (Chromium via Playwright MCP) on 2025-12-18, role: admin.  
- **Steps to Reproduce:**  
  1. Login as admin (`admin@school.local` / `admin123`).  
  2. Observe browser console upon landing on `/dashboard`.  
- **Expected:** No console errors; dashboard renders cleanly.  
- **Actual:** Console logs `Minified React error #418 ... HTML` immediately after navigation.  
- **Evidence:** Playwright console capture during session (MCP 2025-12-18).  
- **Suspected Area:** Dashboard layout hydration / Next.js React 19 markup mismatch.

## P1 / Major – Logout button returns 403 and does not end session
- **Severity:** P1 (auth/session)  
- **Impact:** Admin cannot log out; session persists, potential security/privacy risk on shared devices.  
- **Environment:** https://phrasongsa-timetable.vercel.app/ (header logout) on 2025-12-18, role: admin.  
- **Steps to Reproduce:**  
  1. Login as admin.  
  2. Click the header “ออกจากระบบ” button.  
  3. Attempt to navigate to `/signin`.  
- **Expected:** Session cleared, redirected to `/signin`, no access to dashboard without re-login.  
- **Actual:** Console shows 403; stays on /management. Navigating to `/signin` bounces back to `/dashboard`, session still active.  
- **Evidence:** Playwright run (MCP 2025-12-18) showing 403 on logout request and redirect back to dashboard.  
- **Suspected Area:** Auth.js signOut handler / route protection middleware.

## P2 / Minor – Login form lacks `<form>` container (console warning)
- **Severity:** P2 (usability/accessibility)  
- **Impact:** Possible accessibility/autofill issues; console noise during auth; may block form-level validation or Enter-key submit on some browsers.  
- **Environment:** https://phrasongsa-timetable.vercel.app/signin (Chromium via Playwright MCP) on 2025-12-18, role: unauthenticated.  
- **Steps to Reproduce:**  
  1. Navigate to `/signin`.  
  2. Open browser console.  
  3. Enter any email/password.  
  4. Click “เข้าสู่ระบบ”.  
- **Expected:** Form submits without console errors; inputs wrapped in a `<form>` element to support native submission and accessibility.  
- **Actual:** Console logs `Password field is not contained in a form` and login still sends request.  
- **Evidence:** Playwright console log captured during run (MCP session 2025-12-18).  
- **Suspected Area:** `src/app/signin` page / SignInForm component markup.

## P1 / Major – Cannot create grade level (DisplayID missing on server)
- **Severity:** P1 (functional)  
- **Impact:** Admins cannot add new classes/sections; backend rejects creation with Prisma error requiring `DisplayID`, blocking semester setup.  
- **Environment:** https://phrasongsa-timetable.vercel.app/management/gradelevel on 2025-12-18, role: admin.  
- **Steps to Reproduce:**  
  1. Go to Grade Level management.  
  2. Click “เพิ่ม”, enter Year=1, Number=99, Program=M1-SCI, StudentCount=1.  
  3. Click save.  
- **Expected:** Grade created with code `M1-99`.  
- **Actual:** Error toast: “เพิ่มจัดการระดับชั้นไม่สำเร็จ … DisplayID is missing.” No record created.  
- **Evidence:** Playwright attempt after repository fix; production build still returns Prisma validation error.  
- **Suspected Area:** Grade level server action still not setting `DisplayID` in deployed build (backend schema requires it).
