generator client {
  provider = "prisma-client"
  output   = "../prisma/generated"
}

datasource db {
  provider = "postgresql"
}

model class_schedule {
  ClassID                 String                    @id
  TimeslotID              String
  SubjectCode             String
  RoomID                  Int?
  GradeID                 String
  IsLocked                Boolean                   @default(false)
  gradelevel              gradelevel                @relation(fields: [GradeID], references: [GradeID], onDelete: Cascade, map: "fk_class_schedule_grade")
  room                    room?                     @relation(fields: [RoomID], references: [RoomID], map: "fk_class_schedule_room")
  subject                 subject                   @relation(fields: [SubjectCode], references: [SubjectCode], onDelete: Cascade, map: "fk_class_schedule_subject")
  timeslot                timeslot                  @relation(fields: [TimeslotID], references: [TimeslotID], onDelete: Cascade, map: "fk_class_schedule_timeslot")
  teachers_responsibility teachers_responsibility[] @relation("class_scheduleToteachers_responsibility")

  @@unique([TimeslotID, GradeID], map: "class_schedule_timeslot_grade_unique")
  @@unique([TimeslotID, RoomID], map: "class_schedule_timeslot_room_unique")
  @@index([GradeID])
  @@index([RoomID])
  @@index([SubjectCode])
  @@index([TimeslotID])
  @@index([GradeID, IsLocked], map: "class_schedule_grade_locked_idx")
}

model gradelevel {
  GradeID                 String                    @id
  Year                    Int
  Number                  Int
  StudentCount            Int                       @default(0)
  ProgramID               Int?
  class_schedule          class_schedule[]
  program                 program?                  @relation(fields: [ProgramID], references: [ProgramID], map: "fk_gradelevel_program")
  teachers_responsibility teachers_responsibility[]

  @@unique([Year, Number], map: "gradelevel_year_number_unique")
  @@index([ProgramID])
  @@index([Year])
}

model room {
  RoomID         Int              @id @default(autoincrement())
  RoomName       String           @unique
  Building       String           @default("-")
  Floor          String           @default("-")
  class_schedule class_schedule[]
}

model subject {
  SubjectCode             String                    @id
  SubjectName             String
  Credit                  subject_credit
  ActivityType            ActivityType?
  Description             String?
  IsGraded                Boolean                   @default(true)
  LearningArea            LearningArea?
  Category                SubjectCategory           @default(CORE)
  class_schedule          class_schedule[]
  program_subject         program_subject[]
  teachers_responsibility teachers_responsibility[]

  @@index([Category])
  @@index([LearningArea])
  @@index([ActivityType])
}

model program {
  ProgramID       Int               @id @default(autoincrement())
  ProgramName     String
  Description     String?
  IsActive        Boolean           @default(true)
  MinTotalCredits Float             @default(0)
  ProgramCode     String            @unique
  Track           ProgramTrack
  Year            Int
  gradelevel      gradelevel[]
  program_subject program_subject[]

  @@unique([Year, Track], map: "program_year_track_unique")
  @@index([Year])
  @@index([IsActive])
}

model program_subject {
  ProgramSubjectID Int             @id @default(autoincrement())
  ProgramID        Int
  SubjectCode      String
  Category         SubjectCategory
  IsMandatory      Boolean         @default(true)
  MinCredits       Float
  MaxCredits       Float?
  SortOrder        Int             @default(0)
  program          program         @relation(fields: [ProgramID], references: [ProgramID], onDelete: Cascade, map: "fk_program_subject_program")
  subject          subject         @relation(fields: [SubjectCode], references: [SubjectCode], onDelete: Cascade, map: "fk_program_subject_subject")

  @@unique([ProgramID, SubjectCode], map: "program_subject_unique")
  @@index([ProgramID])
  @@index([SubjectCode])
  @@index([Category])
  @@index([IsMandatory])
}

model teacher {
  TeacherID               Int                       @id @default(autoincrement())
  Prefix                  String
  Firstname               String
  Lastname                String
  Department              String                    @default("-")
  Email                   String                    @unique
  Role                    String                    @default("teacher")
  teachers_responsibility teachers_responsibility[]

  @@index([Department])
}

model timeslot {
  TimeslotID     String           @id
  AcademicYear   Int
  Semester       semester
  StartTime      DateTime         @db.Time(0)
  EndTime        DateTime         @db.Time(0)
  Breaktime      breaktime
  DayOfWeek      day_of_week
  class_schedule class_schedule[]

  @@index([AcademicYear, Semester, DayOfWeek], map: "timeslot_term_day_idx")
}

model teachers_responsibility {
  RespID         Int              @id @default(autoincrement())
  TeacherID      Int
  GradeID        String
  SubjectCode    String
  AcademicYear   Int
  Semester       semester
  TeachHour      Int
  gradelevel     gradelevel       @relation(fields: [GradeID], references: [GradeID], onDelete: Cascade, map: "fk_teachers_responsibility_grade")
  subject        subject          @relation(fields: [SubjectCode], references: [SubjectCode], onDelete: Cascade, map: "fk_teachers_responsibility_subject")
  teacher        teacher          @relation(fields: [TeacherID], references: [TeacherID], onDelete: Cascade, map: "fk_teachers_responsibility_teacher")
  class_schedule class_schedule[] @relation("class_scheduleToteachers_responsibility")

  @@unique([TeacherID, GradeID, SubjectCode, AcademicYear, Semester], map: "teachers_responsibility_unique")
  @@index([TeacherID])
  @@index([GradeID])
  @@index([SubjectCode])
  @@index([TeacherID, AcademicYear, Semester], map: "teachers_responsibility_teacher_term_idx")
}

model table_config {
  ConfigID           String         @id
  AcademicYear       Int
  Semester           semester
  Config             Json
  configCompleteness Int            @default(0)
  createdAt          DateTime       @default(now())
  isPinned           Boolean        @default(false)
  lastAccessedAt     DateTime       @default(now())
  publishedAt        DateTime?
  status             SemesterStatus @default(DRAFT)
  updatedAt          DateTime       @default(now()) @updatedAt

  @@index([status])
  @@index([isPinned], map: "table_config_pinned_idx")
  @@index([lastAccessedAt], map: "table_config_accessed_idx")
}

model User {
  id            String    @id @default(cuid())
  name          String
  email         String    @unique
  image         String?
  password      String?
  role          String    @default("user")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  banExpires    DateTime?
  banReason     String?
  banned        Boolean?  @default(false)
  emailVerified Boolean   @default(false)
  accounts      Account[]
  sessions      Session[]
}

model Account {
  userId                String
  scope                 String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  accessToken           String?
  accessTokenExpiresAt  DateTime?
  accountId             String
  id                    String    @id @default(cuid())
  idToken               String?
  password              String?
  providerId            String
  refreshToken          String?
  refreshTokenExpiresAt DateTime?
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([providerId, accountId])
}

model Session {
  userId         String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  impersonatedBy String?
  expiresAt      DateTime
  id             String   @id @default(cuid())
  ipAddress      String?
  token          String   @unique
  userAgent      String?
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Verification {
  id         String   @id @default(cuid())
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([identifier, value])
}

enum SemesterStatus {
  DRAFT
  PUBLISHED
  LOCKED
  ARCHIVED
}

enum day_of_week {
  MON
  TUE
  WED
  THU
  FRI
  SAT
  SUN
}

enum subject_credit {
  CREDIT_05
  CREDIT_10
  CREDIT_15
  CREDIT_20
}

enum semester {
  SEMESTER_1
  SEMESTER_2
}

enum breaktime {
  BREAK_JUNIOR
  BREAK_SENIOR
  BREAK_BOTH
  NOT_BREAK
}

enum ProgramTrack {
  SCIENCE_MATH
  LANGUAGE_MATH
  LANGUAGE_ARTS
  GENERAL
}

enum SubjectCategory {
  CORE
  ADDITIONAL
  ACTIVITY
}

enum LearningArea {
  THAI
  MATHEMATICS
  SCIENCE
  SOCIAL
  HEALTH_PE
  ARTS
  CAREER
  FOREIGN_LANGUAGE
}

enum ActivityType {
  CLUB
  SCOUT
  GUIDANCE
  SOCIAL_SERVICE
}
